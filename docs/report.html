<!DOCTYPE html PUBLIC "-//W3C//Ddiv XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/Ddiv/xhtml1-strict.ddiv">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
    <title>CS 184 FINAL PROJECT</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link href="style.css" rel="stylesheet" />
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
      </script>
  </head>

  <body>
    <nav>
      <a href="index.html">Home</a> |
      <a href="proposal.html">Proposal</a> |
      <a href="milestone.html">Milestone</a> |
      <a href="report.html">Final Report</a>
    </nav>
    <!-- end navbar -->

    <header>
      <h1>CS 184: Computer Graphics and Imaging, Spring 2021</h1>
      <h1>Final Project: Weather Simulation</h1>
      <h2>Ankit Agarwal, April Sin, Austin Kao, Xinyun Cao</h2>
    </header>
    <!-- END PAGE HEADER -->

    <br class="spacer" />

    <h1>Project Report</h1>

    <div class="table-of-contents">
      <ul>
        <li><a href="#overview">Abstract</a></li>
        <li><a href="#technical">Technical Apporach</a>
          <ul>
            <li><a href="#challenges">Problems and Challenges</a></li>
          </ul>
        </li>
        <li><a href="#results">Results</a></li>

        <li><a href="#resources">Resources</a></li>
        <li><a href="#contributions">Team Contributions</a></li>
      </ul>
    </div><!-- end table of contents -->

    <!-- START PAGE CONTENT -->
    <div class="content">

      <div class="section" id="overview">
        <h2>Abstract</h2>
        <p>Our goal was to create a VR experience that helps people relax by incorporating nature elements. We worked on
          top of <a href="https://github.com/SebLague/Clouds" target="_blank" rel="noopener">this</a>
          cloud simulation done by <a href="https://www.youtube.com/channel/UCmtyQOKKmrMVaKuRXz02jbQ" target="_blank"
            rel="noopener">Sebastian Lague</a> with Unity, and added lightning by mainly following <a
            href="https://dl.acm.org/doi/10.1145/192161.192256">this SIGGRAPH paper</a>. With various parameter
          tweaking, we
          acheived some cool results.</p>

        <div class="grid">
          <div class="image">
            <img src="images/seblague.jpeg" />
            <figcaption>Demo Image from SebLague</figcaption>
          </div>
        </div>
      </div><!-- END OVERVIEW -->

      <div class="section" id="technical">
        <h2> Technical Approach </h2>

        Overall, our technical approach pulled from <a href="https://dl.acm.org/doi/10.1145/192161.192256">this SIGGRAPH
          paper from 1994</a> involving the visual simulation of
        lightning. There
        were other options and papers to choose from, such as this which involves physically based lightning rendering.
        However, we realized that
        in the given time constraints we could not execute such a complicated design in real time in Unity, and we
        wanted to work with a game engine and
        deliver real time results. For this reason, we went with the approach outlined by the original SIGGRAPH paper.

        <h3 id="geometry">Geometry</h3>
        <p>
          The geometry approach of our lightning is directly modeled off of the SIGGRAPH paper, with various parameter
          difference, for more aesthetic and visually appealing results.
        </p>

        <p> A single <b>lightning stroke</b> is modeled
          as a tree structure of <b>lightning branches</b>, the root of which is called the <b>main channel</b>. A
          lightning branch, is made up of an array of individual <b>lightning segments</b>. To construct such a
          structure, we first generate the individual segments in an array. Then, we iterate through the array and
          with
          some probability,
          at index $i$, construct a child branch that branches after segment $i$. We would do this up to a maximum
          depth
          (which was 5 in our case).
        </p>

        <div class="row">
          <div class="image">
            <img src="images/ms_lightning1.png" />
            <!-- <figcaption>Demo Image from SebLague</figcaption> -->
          </div>
          <div class="image">
            <img src="images/ms_lightning2.png" />
            <!-- <figcaption>Demo Image from SebLague</figcaption> -->
          </div>
          <div class="image">
            <img src="images/ms_lightning3.png" />
            <!-- <figcaption>Demo Image from SebLague</figcaption> -->
          </div>
        </div>

        <p>
          Lightning segments were modeled as cylinder primitives that would contain a starting position and a length
          vector that would determine its size and direction. Lightning is often stepped and winding, and as a result,
          we had a somewhat complex algorithm for determining the direction of successive segments. Let $v_0$ be the
          starting vector of the first segment in a given branch. Then, for a segment $i$, its direction vector $v_i$,
          we have that $\angle (v_{i-1} + v_0), v_i$ is a normal random variable with mean $0.279$ radians and variance
          $0.1$. This differs from the SIGGRAPH paper, which just used $v_0$. We used $v_{i -1} + v_0$ since it alloww
          lightning to meander more realistically while also having a bias towards the ground. The difference is
          significant, and
          can be seen below.
        </p>

        <p> For child branches, their initial segment was chosen to be between 0.25 and 0.75 radians with respect to the
          parent segment. Finally, the initial segment was chosen to have an angle of a random variable with mean
          $0.279$ and variance $0.1$ with respect to the down vector. This can be replaced with any vector that moves
          towards the ground component.
        </p>

        <p>
          Finally, we needed to determine how the width of each lightning stroke changes. Since the width of the stroke
          is also a factor in the glow of the branch, we right now only look at the maximum width. Since lightning sends
          most of its energy through the main channel, the width of each successive segment is the same throughout the
          stroke.
          For any child branches, the rules are different. Successive branches are $0.95$ the width of the previosu
          segment, and
          the initial branch is chosen uniformly to be between $0.85$ and $0.95$ the width of its parent segment.
        </p>

        <p>
          Other randomized components of lightning were the length of each segment, which was chosen to be between
          $0.04$ and $0.075$ of the distance
          from the start and ending positions of the lightning. A GIF of the lightninggeometry is available below:
        </p>

        <!-- end geometry -->


        <h3 id="animation"> Animation </h3>

        <p>
          For animation, there were multiple components we wanted to model with regards to the lightning, namely:

        <ul>
          <li>
            Visual progression from top to bottom
          </li>
          <li>
            Decaying stroke brightness
          </li>
          <li>
            Return strokes on the main channel (i.e when the main channel flashes back and forth)
          </li>
        </ul>

        In reality, no such visual progression exists, however we often percieve lightning as moving from the clouds to
        the ground, and so it is best animated as such.



        </p>

        <!-- end animation -->


        <h3 id="color"> Color and Material </h3>
        <div class="grid">
          <div class="image">
            <img src="images/lightning1.gif" />
            <figcaption>Without glow material</figcaption>
          </div>
          <div class="image">
            <img src="images/lightning2.gif" />
            <figcaption>With glow materiale</figcaption>
          </div>
        </div>
        <!-- end color & material -->

        <h3 id="unity"> Unity Integration </h3>
        <p>For unity integration, we update the <code>update()</code> fucntion such that for every frame. The function
          will generate
          a new lightning with probability equal to global variable <code>SpawnProb</code>. The function also keeps
          track of a list of all lightning, updating the animation of each lightning and removing it from the list when
          a lightning reaches the end of it's life cycle. During the transition phrases from stormy to sunny, we
          decrement <code>SpawnProb</code> geometrically to slowly limit the number of lightning as the weather changes
          and did a linear interpolation of the the
          parameter of the stormy clouds to sunny clouds to achieve a smooth transition.
        </p>
        <!-- end unity -->

        <h3 id="param-tweak"> Parameter Tweaking and Tricks </h3>
        <p>Parameter tweaking took a lot of time. It was pretty tedious but made the biggest visual differences.</p>
        <p>Initially, we followed all the numbers listed on the paper. The results were not bad, but the lightning were
          rather linear and straight with little variation. Then, we played around with
          <code>segment_angle</code> and <code>max_depth</code> of lightning branches to achieve more zig-zagged
          lightning closer to the following image.
        <div class="grid">
          <div class="image">
            <img src="images/target_lightning.png" />
            <!-- <figcaption>Demo Image from SebLague</figcaption> -->
          </div>
        </div>
        </p>
        <!-- end parameter tweaking -->

        <h3 id="challenges"> Problems and Challenges </h3>
        <p>The main problem we encountered is that none of us know unity very well going into the
          project. It took us a while to learn the structure of Unity as well as the basic syntax of C#. Another
          challenges we encounted is that since we
          are basing our project on someone else's code and building new features on top, the limited documentation
          makes it harder to understand the
          codebase
        </p>
        <!-- end challenges -->

        <h3 id="lessons learned"> Lessons Learned </h3>
        <p>We realize how hard it is to work off of someone else' code, especially when there is no documentation.</p>
        <!-- end lessons learned -->

      </div><!-- END TECHNICAL -->


      <div class="section" id="results">
        <h2>Results</h2>
        <p></p>
        <div class="center">
          <iframe
            src="https://docs.google.com/presentation/d/e/2PACX-1vRMz3ntO6JF09mKCFyqfDP7OdXiOaM_T91VQE_CsBi3QWZsDVvlpFTYZsQkaHtIQ7yGDUKLpBVBQyJY/embed?start=false&loop=false&delayms=3000"
            frameborder="0" width="480" height="299" allowfullscreen="true" mozallowfullscreen="true"
            webkitallowfullscreen="true"></iframe>
          <video>
            <source src="https://drive.google.com/file/d/1vG13-Gwm9Vft6Fseih7V8YyuYOsTn0u5/view?usp=sharing">
          </video>
        </div>
      </div><!-- END RESULTS -->


      <div class="section" id="resources">
        <h2>Resources</h2>
        <ul>
          <li>
            <a href="https://github.com/SebLague/Clouds">Cloud simulation by Sebastian Lague in Unity</a>
          </li>
          <li>
            <a href="https://dl.acm.org/doi/10.1145/192161.192256">Visual simulation of lightning</a>
          </li>
          <li>
            <a href="http://gamma.cs.unc.edu/LIGHTNING/lightning.pdf">Physically Based Animation and Rendering of
              Lightning</a>
          </li>
          <li>
            <a href="http://gamma.cs.unc.edu/FAST_LIGHTNING/lightning_tvcg_2007.pdf">Fast Lightning Rendering</a>
          </li>
        </ul>
      </div><!-- END RESOURCES -->

      <div class="section" id="contributions">
        <h2>Team Contributions</h2>
        <ul>
          <li>Ankit</li>
          <li>April</li>
          <li>Xinyun</li>
          <li>Austin</li>
        </ul>
      </div><!-- END CONTRIBUTION -->

    </div>
    <!-- END CONTENT -->



    <hr />

    <footer>
      <a href="#">Back to top</a>
    </footer>
  </body>

</html>
